# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å Prometheus –∏ Grafana

Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å—Ç–µ–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ Prometheus –∏ Grafana.

## üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **Prometheus** (v2.52.0) - —Å–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫
- **Grafana** (v11.1.0) - –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- **Pushgateway** - —à–ª—é–∑ –¥–ª—è –ø—Ä–∏–µ–º–∞ –º–µ—Ç—Ä–∏–∫ —á–µ—Ä–µ–∑ push-–º–æ–¥–µ–ª—å
- **Node Exporter** - —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ —Ö–æ—Å—Ç–∞

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–∞–ø–∫—É `grafana`

2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–±–ª–æ–Ω–∞:
   ```bash
   cp .env.example .env
   ```

3. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è Grafana:
   ```bash
   nano .env
   ```

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å—Ç–µ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
   ```bash
   docker-compose up -d
   ```

### –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –∞–¥—Ä–µ—Å–∞–º:

- **Grafana**: http://localhost:3000
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `Administrator` (–∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `.env`)
  - –ü–∞—Ä–æ–ª—å: –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `GF_SECURITY_ADMIN_PASSWORD` –≤ `.env`

- **Prometheus**: http://localhost:9090

- **Pushgateway**: http://localhost:9091

- **Node Exporter**: http://localhost:9100/metrics

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Grafana –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ —Ñ–∞–π–ª `.env`:

- `GF_SECURITY_ADMIN_USER` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `Administrator`)
- `GF_SECURITY_ADMIN_PASSWORD` - –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (**–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å!**)

### Prometheus

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `prometheus.yml`. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ jobs:

- `prometheus` - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∞–º–æ–≥–æ Prometheus
- `pushgateway` - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∏–∑ Pushgateway
- `node_exporter` - —Å–±–æ—Ä —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ —Ö–æ—Å—Ç–∞

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana

1. –í–æ–π–¥–∏—Ç–µ –≤ Grafana (http://localhost:3000)
2. –î–æ–±–∞–≤—å—Ç–µ Prometheus –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:
   - URL: `http://prometheus:9090`
   - Access: `Server (default)`
3. –°–æ–∑–¥–∞–π—Ç–µ –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫

## üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ—Ç—Ä–∏–∫ —á–µ—Ä–µ–∑ Pushgateway

–í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ Pushgateway –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–±–æ—Ä–∞ Prometheus:

```bash
echo "some_metric 3.14" | curl --data-binary @- http://localhost:9091/metrics/job/some_job
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫

Node Exporter –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã —Ö–æ—Å—Ç–∞. –≠—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ Prometheus –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –≤ Grafana.

## üõ† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
docker-compose down
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö
```bash
docker-compose down -v
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose logs -f

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å
docker-compose logs -f prometheus
docker-compose logs -f grafana
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
```bash
docker-compose restart grafana
```

## üìù –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

- –î–∞–Ω–Ω—ã–µ Prometheus —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ volume `prometheus_data` (—Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 90 –¥–Ω–µ–π)
- –î–∞–Ω–Ω—ã–µ Grafana (–¥–∞—à–±–æ—Ä–¥—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏) —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ volume `grafana_storage`

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –ü–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π –≤ –ø—É–±–ª–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:

1. –§–∞–π–ª `.env` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore` (—É–∂–µ –≤–∫–ª—é—á–µ–Ω)
2. –í—ã —Å–æ–∑–¥–∞–ª–∏ `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example` —Å –≤–∞—à–∏–º–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
3. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Ñ–∞–π–ª `.env` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Prometheus](https://prometheus.io/docs/)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Grafana](https://grafana.com/docs/)
- [Node Exporter](https://github.com/prometheus/node_exporter)
- [Pushgateway](https://github.com/prometheus/pushgateway)

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Grafana –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Prometheus

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
- Prometheus –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω (`docker-compose ps`)
- –í Grafana –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è URL `http://prometheus:9090` (–∏–º—è —Å–µ—Ä–≤–∏—Å–∞ –∏–∑ docker-compose)

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ volumes, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `sudo` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
